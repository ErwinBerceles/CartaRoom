<template>
<div class="results">
    <ul>
        <h2>Search Results<br /><br /> </h2>
            <ul v-for="room of rooms" v-bind:key="room['.key']">
                Name: {{room.name}} <br />
        Capacity: {{room.capacity}} <br />
        Address: {{room.address}} <br />
        Hours of Operation: {{room.openTime}} to {{room.closeTime}} <br>
                <button v-on:click="viewRoom(room.roomID)">View Room</button>
                <!-- <button v-on:click="bookRoom(room)">Book Room</button> <br /> -->
            </ul>
            <router-link to="/search">Back to Search</router-link>
    </ul>
    <!-- <Recommended></Recommended> -->
</div>
</template>

<script>
import firebase from 'firebase';
import db from '@/firebase.js';
// db.ref('rooms').once('value').then(function(snapshot) {
//   console.log(snapshot.val());
// }).catch((error) => {
//   console.log(error);
// });
export default {
    name: 'results',
    data() {
        return {
            rooms: [],
            criteria: ''
        }
    },
    created() {
        this.criteria = this.$route.params.criteria;
        db.ref('rooms').orderByChild("name").startAt(this.criteria).endAt(this.criteria + "\uf8ff").once('value').then((snapshot) => {
            this.rooms = [];
            snapshot.forEach((doc) => {
                this.rooms.push(doc.val());
            })

        // db.ref('rooms').orderByChild("description").startAt(this.criteria).endAt(this.criteria + "\uf8ff").once('value').then((snapshot) => {
        // snapshot.forEach((doc) => {
        //   this.rooms.push(doc.val());
        // }) 

      // }).catch((error) => {
      //   console.log(error);
      // });

        }).catch((error) => {
            console.log(error);
        });
    },
    methods: {
        //  bookRoom: function(room) {
        //     var userInfo = firebase.auth().currentUser.email;
        //     var uniqueKeyIDBooking = '1';
        //     //console.log(room)
        //     //console.log('Start Time: ' + this.startTime)
        //     firebase.database().ref('rooms/' + room.uniqueKey).update({userID: room.userID, name: room.name, capacity: room.capacity, description: room.description, address: room.address, uniqueKey: room.uniqueKey, reserved: 'true'})
        //     uniqueKeyIDBooking = firebase.database().ref('currentBookings').push({room: room, user: userInfo, bookingID: '1',startTime: this.startTime,endTime: this.endTime,date: this.date})
        //     firebase.database().ref('currentBookings/' + uniqueKeyIDBooking.key).update({room: room, user: userInfo, bookingID: uniqueKeyIDBooking.key,startTime: this.startTime,endTime: this.endTime,date: this.date})
        //     uniqueKeyIDBooking = firebase.database().ref('allBookings').push({room: room, user: userInfo, bookingID: '1',startTime: this.startTime,endTime: this.endTime,date: this.date})
        //     firebase.database().ref('allBookings/' + uniqueKeyIDBooking.key).update({room: room, user: userInfo, bookingID: uniqueKeyIDBooking.key,startTime: this.startTime,endTime: this.endTime,date: this.date})
        //     alert('Congrats you have booked the room!');
        //     this.$router.go();
        //  }
        viewRoom: function (id) {
            this.$router.push({
                name: 'RoomViewPatron',
                params: {
                    id: id
                }
            })
        }
    }
}
</script>
